<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>AR Navigation with 3D Arrow</title>
  <style>
    body { margin: 0; }
    #ar-view { width: 100vw; height: 100vh; position: relative; }
    #start-ar-button { position: absolute; top: 20px; left: 20px; padding: 10px 20px; background: #000; color: #fff; border: none; border-radius: 5px; cursor: pointer; z-index: 10; }
    #overlay { position: absolute; top: 20px; left: 20px; z-index: 10; }
  </style>
</head>
<body>
  <button id="start-ar-button">StartD AR</button>
  <div id="ar-view"></div>
  <div id="overlay">
    <select id="room-select">
      <option value="18.9576799,72.8097855">Target Room</option>
      <!-- Add more rooms as needed -->
    </select>
  </div>

  <!-- Include Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>

  <script>
    let xrButton, gl, renderer, scene, camera, arrow, xrSession, xrRefSpace;
    const targetLat = 18.9576799;
    const targetLon = 72.8097855;
    const targetPosition = new THREE.Vector3(targetLat / 100, targetLon / 100, -5); // Example conversion

    function init() {
      xrButton = document.getElementById('start-ar-button');
      xrButton.addEventListener('click', async () => {
        xrButton.style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
        initGL();
        if (navigator.xr) {
          const session = await navigator.xr.requestSession('immersive-ar');
          onSessionStarted(session);
        } else {
          console.error('WebXR not supported');
        }
      });
    }

    function initGL() {
      gl = document.createElement('canvas').getContext('webgl', { xrCompatible: true });
      document.getElementById('ar-view').appendChild(gl.canvas);

      renderer = new THREE.WebGLRenderer({ canvas: gl.canvas });
      renderer.setSize(gl.canvas.width, gl.canvas.height);

      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, gl.canvas.width / gl.canvas.height, 0.1, 1000);

      // Create a simple 3D arrow
      const geometry = new THREE.ConeGeometry(0.1, 0.5, 32);
      const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
      arrow = new THREE.Mesh(geometry, material);
      arrow.position.set(0, 0, -5); // Start position of the arrow
      scene.add(arrow);

      // Create a simple light
      const light = new THREE.AmbientLight(0xffffff); // Ambient light
      scene.add(light);
    }

    async function onSessionStarted(session) {
      xrSession = session;
      xrRefSpace = await xrSession.requestReferenceSpace('local');
      xrSession.updateRenderState({ baseLayer: new XRWebGLLayer(xrSession, gl) });

      xrSession.requestAnimationFrame(onXRFrame);
      xrSession.addEventListener('end', () => {
        xrButton.style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
      });
    }

    function onXRFrame(time, frame) {
      const pose = frame.getViewerPose(xrRefSpace);

      if (pose) {
        updateArrowDirection();
        renderer.render(scene, camera);
      }

      frame.session.requestAnimationFrame(onXRFrame);
    }

    function updateArrowDirection() {
      navigator.geolocation.getCurrentPosition((position) => {
        const userLat = position.coords.latitude;
        const userLon = position.coords.longitude;

        const userPosition = new THREE.Vector3(userLat / 100, userLon / 100, 0); // Example conversion

        // Calculate direction vector
        const direction = new THREE.Vector3().subVectors(targetPosition, userPosition).normalize();

        // Update arrow orientation
        arrow.lookAt(direction);
      }, (error) => {
        console.error('Geolocation error:', error);
      });
    }

    init();
  </script>
</body>
</html>
